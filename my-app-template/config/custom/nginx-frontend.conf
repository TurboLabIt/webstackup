## ğŸš¨ WARNING ğŸš¨
#
# This file is under version control!
# DO NOT EDIT DIRECTLY - If you do, you'll loose your changes!
#
# The original file is in `/var/www/my-app/config/custom/`
#
# âš ï¸ This file is SHARED among dev|staging|prod âš ï¸
#
# ğŸª„ Based on https://github.com/TurboLabIt/webstackup/blob/master/my-app-template/config/custom/nginx-frontend.conf

set $APP_NAME my-app;

## ğŸ‘® Extra-security (requires a valid HTTPS certificate)
# https://github.com/TurboLabIt/webstackup/blob/master/config/nginx/70_security.conf
#include /usr/local/turbolab.it/webstackup/config/nginx/70_security.conf;

## ğŸ‘¾ Rate-limiting
# https://github.com/TurboLabIt/webstackup/blob/master/config/nginx/90_rate-limit.conf
include /usr/local/turbolab.it/webstackup/config/nginx/90_rate-limit.conf;

## ğŸŒ public webroot ("htdocs")
root $PROJECT_DIR/public;

## ğŸ§¹ Clean the root
# https://github.com/TurboLabIt/webstackup/blob/master/config/nginx/95_clean_root.conf
#include /usr/local/turbolab.it/webstackup/config/nginx/95_clean_root.conf;

## ğŸ§° Maintenace - To activate:
# https://github.com/TurboLabIt/webstackup/blob/master/my-app-template/scripts/maintenance.sh
include /usr/local/turbolab.it/webstackup/config/nginx/06_maintenace.conf;

## ğŸ« Lowercase URLs
# https://github.com/TurboLabIt/webstackup/blob/master/config/nginx/35_lowercase.conf
include /usr/local/turbolab.it/webstackup/config/nginx/35_lowercase.conf;

## ğŸ›ï¸ WooCommerce: products and categories URL must end with trailing-slash
rewrite ^/((?:categoria-prodotto|prodotto)/.*[^/])$ /$1/ permanent;

## ğŸ›£ Redirect map
if ($wsuRedirectToMap_my-app) {
  return 301 $wsuRedirectToMap_my-app;
}

## ğŸ¤ Frontend compression and caching
# https://github.com/TurboLabIt/webstackup/blob/master/config/nginx/50_compression.conf
include /usr/local/turbolab.it/webstackup/config/nginx/50_compression.conf;

# https://github.com/TurboLabIt/webstackup/blob/master/config/nginx/60_caching.conf
include /usr/local/turbolab.it/webstackup/config/nginx/60_caching.conf;

## ğŸ“‰ Monitor
include /etc/turbolab.it/webstackup-nginx-monitor*.conf;

## ğŸ›‚ Restricted folder
location /restricted-folder/ {

  satisfy all;
  include /etc/turbolab.it/webstackup-nginx-allow-deny-list*.conf;
  deny all;

  ## Auth
  auth_basic "Restricted folder";
  auth_basic_user_file /usr/local/turbolab.it/webstackup/autogenerated/httpauth_welcome;

  try_files $uri $uri/ /index.php$is_args$args;
}

## ğŸ“ƒ Logging
error_log /var/log/nginx/my-app_error.log;
access_log /var/log/nginx/my-app_access.log;
