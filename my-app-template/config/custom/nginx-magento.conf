## 🚨 WARNING 🚨
#
# This file is under version control!
# DO NOT EDIT DIRECTLY - If you do, you'll loose your changes!
#
# The original file is in `/var/www/my-app/config/custom/`
#
# You MUST:
#
# 1. edit the original file on you PC
# 2. Git-commit+push the changes
# 3. run `sudo bash /var/www/my-app/scripts/deploy.sh`
#
# ⚠️ This file is SHARED among dev|staging|prod ⚠️
#
# 🪄 Based on https://github.com/TurboLabIt/webstackup/blob/master/my-app-template/config/custom/nginx-magento.conf

set $APP_NAME my-app;

## 🔏 Enable HTTPS
include /usr/local/turbolab.it/webstackup/config/nginx/20_https_enable.conf;

## 🧰 Maintenace - To enable/disable, run:
# https://github.com/TurboLabIt/webstackup/blob/master/my-app-template/scripts/maintenance.sh
include /usr/local/turbolab.it/webstackup/config/nginx/06_maintenace.conf;

## 🛣 Redirect map
if ($wsuRedirectToMap_my-app) {
  return 301 $wsuRedirectToMap_my-app;
}

## Lowercase URLs
include /usr/local/turbolab.it/webstackup/config/nginx/35_lowercase.conf;

## Rate-limiting
include /usr/local/turbolab.it/webstackup/config/nginx/90_rate-limit.conf;

## 👉🏻 Extra-security (requires a valid HTTPS certificate)
#include /usr/local/turbolab.it/webstackup/config/nginx/70_security.conf;

## 🔢 PHP version to use
# unused | Magento needs it's own fastcgi_backend_my-app (provided by `nginx-php-fpm.conf`)
#set $PHP_VER my-app-php-version;

## 🧙 Magento
set $MAGE_ROOT $PROJECT_DIR/shop;
include /var/www/my-app/shop/nginx.conf.sample;

## 🏃‍♂️ Async runner (requires a related cron job)
#include /usr/local/turbolab.it/webstackup/config/nginx/45_async-runner-request.conf;

## 📃 Logging
error_log /var/log/nginx/my-app_error.log;
access_log /var/log/nginx/my-app_access.log;
