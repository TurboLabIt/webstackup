### NGINX STATUS PAGE BY WEBSTACKUP
# Enable access to nginx and php status pages from localhost.
#
# If webstackup is installed, it is imemdiately available:
# ls -l /etc/nginx/conf.d/status_page.conf && cat /usr/local/turbolab.it/webstackup/autogenerated/nginx-php_ver.conf"
#
# If it isn't  (replace with the PHP version in use):
# echo "set \$PHP_VER 8.2;" > "/usr/local/turbolab.it/webstackup/autogenerated/nginx-php_ver.conf"
# sudo ln -s /usr/local/turbolab.it/webstackup/config/nginx/85_status_page.conf /etc/nginx/conf.d/status_page.conf
#
# Without webstackup:
# curl -o /etc/nginx/sites-enabled/status_page.conf https://raw.githubusercontent.com/TurboLabIt/webstackup/master/config/nginx/85_status_page.conf && nano /etc/nginx/sites-enabled/status_page.conf
#
# Try it:
# sudo nginx -t && sudo service nginx restart && sudo service php8.2-fpm reload && curl http://127.0.0.1/nginx_status && curl http://127.0.0.1/status

server {

  listen 127.0.0.1:80;
  root /var/www;
  
  ## if the following file is not available, set the PHP version directly like this:
  # set $PHP_VER 8.2;
  include /usr/local/turbolab.it/webstackup/autogenerated/nginx-php_ver.conf;
  
  # nginx status page
  location ~ ^/(stub_status|nginx_status)$ {
    stub_status on;
    access_log off;
    allow 127.0.0.1;
    deny all;
  }
  
  # php-fpm status page
  location ~ ^/(status|ping)$ {
    access_log off;
    allow 127.0.0.1;
    deny all;

    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_index index.php;
    include fastcgi_params;
    fastcgi_pass unix:/run/php/php$PHP_VER-fpm.sock;
  }
  
}
