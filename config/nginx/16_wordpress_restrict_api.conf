## RESTRICT WORDPRESS API ACCESS BY WEBSTACKUP
#

## REST API
# âš  Incompatible with Elementor
# Test: http://example.com/wp-json/wp/v2/users
# https://wordpress.org/support/topic/why-is-the-rest-api-enabled-by-default/
location /wp-json/ {

  allow 127.0.0.1;
  allow 10.0.0.0/8;
  allow 172.16.0.0/12;
  allow 192.168.0.0/16;

  ## Custom white/blacklist
  include /etc/turbolab.it/webstackup-nginx-allow-deny-list*.conf;

  deny all;
  try_files $uri $uri/ /index.php$is_args$args;
}

## XML-RPC
# Test: curl -X POST -H 'Cache-Control: no-cache' -H 'Content-Type: application/xml' -d '<methodCall><methodName>system.listMethods</methodName></methodCall>' https://example.com/xmlrpc.php
location = /xmlrpc.php {

  allow 127.0.0.1;
  allow 10.0.0.0/8;
  allow 172.16.0.0/12;
  allow 192.168.0.0/16;

  ## Custom white/blacklist
  include /etc/turbolab.it/webstackup-nginx-allow-deny-list*.conf;

  deny all;
  try_files $uri $uri/ /xmlrpc.php$is_args$args;
}
