# NGINX example.com config with Varnish by TurboLab.it
#
# See: https://turbolab.it/4221


## Backend web server
server {

  listen 127.0.0.1:8080;
  server_name example.com;
  root /var/www/example.com;  

  include /etc/nginx/php-fpm.conf;
}


## TLS Termination
server {

  server_name example.com;
  root /var/www/example.com;  

  listen 443 ssl;
  listen [::]:443 ssl;

  ssl_certificate /usr/local/turbolab.it/webstackup/autogenerated/https-localhost.crt;
  ssl_certificate_key /usr/local/turbolab.it/webstackup/autogenerated/openssl-private-key.pem;

  #include /etc/nginx/php-fpm.conf;
  include /etc/nginx/varnish.conf;
}


## redirect www.example.com to example.com
server {
  
  server_name www.example.com;
  
  listen 443 ssl;
  listen [::]:443 ssl;

  ssl_certificate /usr/local/turbolab.it/webstackup/autogenerated/https-localhost.crt;
  ssl_certificate_key /usr/local/turbolab.it/webstackup/autogenerated/openssl-private-key.pem;

  return 301 https://$host$request_uri;
}
